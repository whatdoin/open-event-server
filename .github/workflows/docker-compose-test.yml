  name: docker compose the dev build
  on:
    push:
      branches: [ development, experiment ]

  jobs:
    test:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout
          uses: actions/checkout@v3
  
        - name: prebuild setup
          run: |
              cp .env.example .env && \
              echo TEST_DATABASE_URL=postgresql://test@localhost:5433/test >> .env
              
        - name: Tests
          uses: cloudposse/github-action-docker-compose-test-run@main
          with:
            file: docker-compose.yml
            service: app
            command: |
                ./scripts/test_db.sh && \
                echo TEST_DATABASE_URL=postgresql://test@localhost:5433/test >> .env && \
                pytest tests/
